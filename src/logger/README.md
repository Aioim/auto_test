# ä¼ä¸šçº§å®‰å…¨æ—¥å¿—ç³»ç»Ÿ

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€å®‰å…¨å¯é çš„ä¼ä¸šçº§æ—¥å¿—ç³»ç»Ÿï¼Œä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•å’Œåº”ç”¨ç¨‹åºæä¾›å…¨é¢çš„æ—¥å¿—è®°å½•èƒ½åŠ›ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- **æ•æ„Ÿæ•°æ®è„±æ•**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œå±è”½å¯†ç ã€ä»¤ç‰Œã€APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯
- **å®‰å…¨äº‹ä»¶è®°å½•**ï¼šä¸“é—¨çš„å®‰å…¨æ—¥å¿—é€šé“ï¼Œè®°å½•ç”¨æˆ·ç™»å½•ã€æƒé™å˜æ›´ç­‰å®‰å…¨äº‹ä»¶
- **URLå‚æ•°è„±æ•**ï¼šè‡ªåŠ¨å±è”½URLä¸­çš„æ•æ„Ÿå‚æ•°
- **è¯·æ±‚/å“åº”å®‰å…¨æ—¥å¿—**ï¼šå®‰å…¨è®°å½•APIè¯·æ±‚å’Œå“åº”ï¼Œä¿æŠ¤æ•æ„Ÿä¿¡æ¯

### ğŸ“Š æ—¥å¿—ç±»å‹
- **ä¸»æ—¥å¿—** (`test_run.log`)ï¼šåº”ç”¨ç¨‹åºä¸»æ—¥å¿—
- **APIæ—¥å¿—** (`api.log`)ï¼šAPIè¯·æ±‚å’Œå“åº”æ—¥å¿—
- **æ€§èƒ½æ—¥å¿—** (`performance.log`)ï¼šæ€§èƒ½æŒ‡æ ‡å’Œè€—æ—¶è®°å½•
- **å®‰å…¨æ—¥å¿—** (`security.log`)ï¼šå®‰å…¨äº‹ä»¶å’Œå®¡è®¡æ—¥å¿—
- **é”™è¯¯æ—¥å¿—** (`error_YYYYMMDD.log`)ï¼šé”™è¯¯å’Œå¼‚å¸¸è®°å½•
- **è‡ªå®šä¹‰æ—¥å¿—**ï¼šæ”¯æŒåˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶

### âš¡ é«˜çº§åŠŸèƒ½
- **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šæ—¥å¿—å®ä¾‹æŒ‰éœ€åˆ›å»ºï¼Œå‡å°‘å¯åŠ¨å¼€é”€
- **æ€§èƒ½ç›‘æ§**ï¼šå‡½æ•°æ‰§è¡Œæ—¶é—´ç›‘æ§ï¼Œæ ‡è®°æ…¢æ“ä½œ
- **æ­¥éª¤è·Ÿè¸ª**ï¼šå·¥ä½œæµæ­¥éª¤çš„å¼€å§‹å’Œå®Œæˆè®°å½•
- **æ‰§è¡Œæ—¶é•¿è®°å½•**ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨è®°å½•ä»£ç å—æ‰§è¡Œæ—¶é—´
- **å¼‚å¸¸è‡ªåŠ¨æ•è·**ï¼šè‡ªåŠ¨æ•è·å’Œè®°å½•å¼‚å¸¸ï¼ŒåŒ…å«å®Œæ•´å †æ ˆä¿¡æ¯
- **è¯·æ±‚/å“åº”æ—¥å¿—**ï¼šç»“æ„åŒ–è®°å½•APIè¯·æ±‚å’Œå“åº”
- **å½©è‰²æ§åˆ¶å°è¾“å‡º**ï¼šå¼€å‘ç¯å¢ƒå‹å¥½çš„å½©è‰²æ—¥å¿—
- **JSONæ ¼å¼åŒ–**ï¼šæ”¯æŒJSONæ ¼å¼çš„ç»“æ„åŒ–æ—¥å¿—

### ğŸ”§ é…ç½®ç®¡ç†
- **é›†ä¸­é…ç½®**ï¼šç»Ÿä¸€çš„æ—¥å¿—é…ç½®ç®¡ç†
- **æ–‡ä»¶è½®è½¬**ï¼šåŸºäºæ—¶é—´å’Œå¤§å°çš„æ—¥å¿—æ–‡ä»¶è½®è½¬
- **æ—¥å¿—çº§åˆ«æ§åˆ¶**ï¼šæ”¯æŒä¸åŒæ—¥å¿—çº§åˆ«çš„ç²¾ç»†æ§åˆ¶
- **ç¯å¢ƒæ„ŸçŸ¥**ï¼šè‡ªåŠ¨é€‚åº”ä¸åŒç¯å¢ƒçš„æ—¥å¿—é…ç½®

### ğŸ“ˆ å¯è§‚æµ‹æ€§
- **æ—¥å¿—è¯Šæ–­**ï¼šå†…ç½®æ—¥å¿—ç³»ç»Ÿè¯Šæ–­å·¥å…·
- **APIæ—¥å¿—éªŒè¯**ï¼šéªŒè¯APIæ—¥å¿—æ˜¯å¦æ­£ç¡®è®°å½•
- **æ€§èƒ½æŒ‡æ ‡**ï¼šè®°å½•æ—¥å¿—ç³»ç»Ÿè‡ªèº«çš„æ€§èƒ½æŒ‡æ ‡

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from utils.logger import logger

# åŸºæœ¬æ—¥å¿—è®°å½•
logger.debug("è°ƒè¯•ä¿¡æ¯")
logger.info("ä¿¡æ¯æ—¥å¿—")
logger.warning("è­¦å‘Šä¿¡æ¯")
logger.error("é”™è¯¯ä¿¡æ¯")
logger.critical("ä¸¥é‡é”™è¯¯")

# è®°å½•å¼‚å¸¸
try:
    1 / 0
except Exception:
    from utils.logger import log_exception
    log_exception(context="é™¤æ³•è¿ç®—")
```

### é«˜çº§ä½¿ç”¨

#### æ€§èƒ½ç›‘æ§

```python
from utils.logger import log_performance

@log_performance(threshold_ms=100)  # è¶…è¿‡100msæ ‡è®°ä¸ºæ…¢æ“ä½œ
def slow_function():
    # æ‰§è¡Œè€—æ—¶æ“ä½œ
    import time
    time.sleep(0.2)
    return "å®Œæˆ"

# è°ƒç”¨å‡½æ•°ï¼Œè‡ªåŠ¨è®°å½•æ‰§è¡Œæ—¶é—´
result = slow_function()
```

#### æ­¥éª¤è·Ÿè¸ª

```python
from utils.logger import log_step

@log_step("æ•°æ®å¤„ç†")
def process_data(data):
    # å¤„ç†æ•°æ®
    return processed_data

# è°ƒç”¨å‡½æ•°ï¼Œè‡ªåŠ¨è®°å½•æ­¥éª¤å¼€å§‹å’Œå®Œæˆ
result = process_data(raw_data)
```

#### æ‰§è¡Œæ—¶é•¿è®°å½•

```python
from utils.logger import log_duration

with log_duration("æ•°æ®åº“æŸ¥è¯¢"):
    # æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
    results = db.query("SELECT * FROM users")
```

#### APIè¯·æ±‚/å“åº”æ—¥å¿—

```python
from utils.logger import request_logger

# è®°å½•è¯·æ±‚
request_id = request_logger.log_request(
    method="POST",
    url="https://api.example.com/login?username=admin&password=secret"
)

# è®°å½•å“åº”
request_logger.log_response(
    request_id=request_id,
    status_code=200,
    duration_ms=45.6
)
```

#### å®‰å…¨äº‹ä»¶è®°å½•

```python
from utils.logger import log_security_event

# è®°å½•å®‰å…¨äº‹ä»¶
log_security_event(
    action="user_login",
    user="admin",
    resource="/admin",
    status="success",
    details={"ip": "192.168.1.1", "user_agent": "Mozilla/5.0"}
)
```

## æ—¥å¿—å®ä¾‹

ç³»ç»Ÿæä¾›äº†ä»¥ä¸‹é¢„é…ç½®çš„æ—¥å¿—å®ä¾‹ï¼š

| æ—¥å¿—å®ä¾‹ | ç”¨é€” | é»˜è®¤çº§åˆ« | æ—¥å¿—æ–‡ä»¶ |
|---------|------|---------|----------|
| `logger` | ä¸»æ—¥å¿— | INFO | test_run.log |
| `api_logger` | APIæ—¥å¿— | DEBUG | api.log |
| `perf_logger` | æ€§èƒ½æ—¥å¿— | DEBUG | performance.log |
| `security_logger` | å®‰å…¨æ—¥å¿— | INFO | security.log |

## è‡ªå®šä¹‰æ—¥å¿—å™¨

æ‚¨å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—å™¨ä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ï¼š

```python
from utils.logger import setup_logger

# åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—å™¨
custom_logger = setup_logger(
    name="my_app",
    log_level="DEBUG",
    log_to_console=True,
    log_to_file=True,
    separate_log_file="my_app.log"  # è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶
)

# ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—å™¨
custom_logger.info("è‡ªå®šä¹‰æ—¥å¿—ä¿¡æ¯")
```

## æ—¥å¿—æ ¼å¼

ç³»ç»Ÿä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼ï¼ŒåŒ…å«å…­å¤§è¦ç´ ï¼š

```
2026-02-19 15:12:04 INFO     [demo.py:main:42] Application started
```

æ ¼å¼è¯´æ˜ï¼š
1. **æ—¶é—´æˆ³**ï¼š`2026-02-19 15:12:04`
2. **æ—¥å¿—çº§åˆ«**ï¼š`INFO`
3. **æ–‡ä»¶å**ï¼š`demo.py`
4. **å‡½æ•°å**ï¼š`main`
5. **è¡Œå·**ï¼š`42`
6. **æ—¥å¿—å†…å®¹**ï¼š`Application started`

## å®‰å…¨ç‰¹æ€§

### æ•æ„Ÿæ•°æ®è„±æ•

ç³»ç»Ÿä¼šè‡ªåŠ¨è„±æ•ä»¥ä¸‹ç±»å‹çš„æ•æ„Ÿæ•°æ®ï¼š

- å¯†ç ï¼ˆpasswordã€pwdï¼‰
- ä»¤ç‰Œï¼ˆtokenï¼‰
- APIå¯†é’¥ï¼ˆapi_keyã€apikeyï¼‰
- å¯†é’¥ï¼ˆsecretï¼‰
- æˆæƒä¿¡æ¯ï¼ˆauthorizationï¼‰
- Cookieä¿¡æ¯ï¼ˆcookieï¼‰
- X-API-Keyå¤´éƒ¨

è„±æ•ç¤ºä¾‹ï¼š

```python
from utils.logger import logger, mask_sensitive_data

# è‡ªåŠ¨è„±æ•
logger.info("ç”¨æˆ·ç™»å½•: username=admin, password=secret123")
# è¾“å‡º: ç”¨æˆ·ç™»å½•: username=admin, password=******

# æ‰‹åŠ¨è„±æ•
sensitive_data = "APIå¯†é’¥: sk-1234567890abcdef"
desensitized = mask_sensitive_data(sensitive_data)
print(desensitized)  # è¾“å‡º: APIå¯†é’¥: sk-******
```

## è¯Šæ–­å·¥å…·

### æ—¥å¿—ç³»ç»Ÿè¯Šæ–­

```python
from utils.logger import diagnose_logger, print_logger_diagnosis

# è¯Šæ–­æ—¥å¿—ç³»ç»Ÿ
diagnosis = diagnose_logger()

# æ‰“å°è¯Šæ–­ç»“æœ
print_logger_diagnosis(diagnosis)
```

### APIæ—¥å¿—éªŒè¯

```python
from utils.logger import verify_api_logging

# éªŒè¯APIæ—¥å¿—é…ç½®
is_valid = verify_api_logging()
print(f"APIæ—¥å¿—é…ç½®æœ‰æ•ˆ: {is_valid}")
```

## æœ€ä½³å®è·µ

1. **ä½¿ç”¨é€‚å½“çš„æ—¥å¿—çº§åˆ«**ï¼šæ ¹æ®æ¶ˆæ¯çš„é‡è¦æ€§é€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«
2. **æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼šåœ¨æ—¥å¿—æ¶ˆæ¯ä¸­åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
3. **ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—**ï¼šå¯¹äºå¤æ‚æ•°æ®ï¼Œä½¿ç”¨JSONæ ¼å¼çš„ç»“æ„åŒ–æ—¥å¿—
4. **é¿å…æ—¥å¿—è½°ç‚¸**ï¼šä¸è¦åœ¨é«˜é¢‘å¾ªç¯ä¸­è®°å½•è¿‡å¤šæ—¥å¿—
5. **ä½¿ç”¨æ€§èƒ½ç›‘æ§**ï¼šå¯¹å…³é”®å‡½æ•°ä½¿ç”¨æ€§èƒ½ç›‘æ§è£…é¥°å™¨
6. **è®°å½•å¼‚å¸¸**ï¼šä½¿ç”¨`log_exception`è®°å½•å¼‚å¸¸ï¼ŒåŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡
7. **å®‰å…¨æ—¥å¿—**ï¼šä½¿ç”¨`log_security_event`è®°å½•å®‰å…¨ç›¸å…³äº‹ä»¶

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

| ç¯å¢ƒå˜é‡ | æè¿° | é»˜è®¤å€¼ |
|---------|------|-------|
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | INFO |
| `LOG_DIR` | æ—¥å¿—ç›®å½• | `./logs` |
| `ENV` | è¿è¡Œç¯å¢ƒ | development |

### é…ç½®æ–‡ä»¶

æ—¥å¿—ç³»ç»Ÿä¼šä»é¡¹ç›®é…ç½®ä¸­è¯»å–è®¾ç½®ï¼Œä¼˜å…ˆä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

```python
# config/settings.py
log = {
    "log_level": "INFO",
    "log_dir": "./logs",
    "log_file": "test_run.log"
}
env = "development"
```

## ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹

```python
from utils.logger import (
    logger, api_logger, perf_logger, security_logger,
    log_exception, log_security_event, log_step, log_duration, log_performance,
    mask_sensitive_data, request_logger
)

# 1. åŸºæœ¬æ—¥å¿—
def basic_logging():
    logger.info("åº”ç”¨ç¨‹åºå¯åŠ¨")
    logger.warning("ç£ç›˜ç©ºé—´ä¸è¶³")
    
    try:
        1 / 0
    except Exception:
        log_exception(context="é™¤æ³•è¿ç®—")

# 2. æ€§èƒ½ç›‘æ§
@log_performance(threshold_ms=50)
def slow_operation():
    import time
    time.sleep(0.1)
    return "å®Œæˆ"

# 3. æ­¥éª¤è·Ÿè¸ª
@log_step("æ•°æ®å¤„ç†")
def process_data(data):
    # å¤„ç†æ•°æ®
    return [item * 2 for item in data]

# 4. æ‰§è¡Œæ—¶é•¿è®°å½•
def database_operation():
    with log_duration("æ•°æ®åº“æŸ¥è¯¢"):
        # æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        import time
        time.sleep(0.05)
        return ["ç»“æœ1", "ç»“æœ2"]

# 5. APIè¯·æ±‚æ—¥å¿—
def api_request_example():
    # è®°å½•è¯·æ±‚
    request_id = request_logger.log_request(
        method="POST",
        url="https://api.example.com/login?username=admin&password=secret"
    )
    
    # æ¨¡æ‹ŸAPIè°ƒç”¨
    import time
    time.sleep(0.1)
    
    # è®°å½•å“åº”
    request_logger.log_response(
        request_id=request_id,
        status_code=200,
        duration_ms=105.3
    )

# 6. å®‰å…¨äº‹ä»¶æ—¥å¿—
def security_event_example():
    log_security_event(
        action="user_login",
        user="admin",
        resource="/admin",
        status="success",
        details={"ip": "192.168.1.1", "user_agent": "Mozilla/5.0"}
    )

if __name__ == "__main__":
    basic_logging()
    slow_operation()
    process_data([1, 2, 3, 4, 5])
    database_operation()
    api_request_example()
    security_event_example()
    
    logger.info("åº”ç”¨ç¨‹åºæ‰§è¡Œå®Œæˆ")
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ—¥å¿—æ–‡ä»¶æœªç”Ÿæˆ**
   - æ£€æŸ¥æ—¥å¿—ç›®å½•æ˜¯å¦å­˜åœ¨ä¸”å¯å†™
   - æ£€æŸ¥æ—¥å¿—çº§åˆ«è®¾ç½®æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™

2. **æ—¥å¿—çº§åˆ«ä¸ç”Ÿæ•ˆ**
   - ç¡®ä¿åœ¨åˆ›å»ºæ—¥å¿—å®ä¾‹ä¹‹å‰è®¾ç½®æ—¥å¿—çº§åˆ«
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åœ°æ–¹è¦†ç›–äº†æ—¥å¿—çº§åˆ«è®¾ç½®

3. **æ•æ„Ÿæ•°æ®æœªè„±æ•**
   - ç¡®ä¿ä½¿ç”¨äº†æ­£ç¡®çš„æ—¥å¿—æ ¼å¼
   - æ£€æŸ¥æ•æ„Ÿæ•°æ®æ˜¯å¦ä½¿ç”¨äº†æ ‡å‡†å‘½åæ ¼å¼

4. **æ—¥å¿—ç³»ç»Ÿæ€§èƒ½é—®é¢˜**
   - å‡å°‘é«˜é¢‘å¾ªç¯ä¸­çš„æ—¥å¿—è®°å½•
   - å¯¹éå…³é”®è·¯å¾„ä½¿ç”¨æ›´é«˜çš„æ—¥å¿—çº§åˆ«
   - è€ƒè™‘ä½¿ç”¨å¼‚æ­¥æ—¥å¿—å¤„ç†å™¨

### æ—¥å¿—ç³»ç»Ÿè‡ªæ£€

```python
from utils.logger import diagnose_logger, print_logger_diagnosis

# è¿è¡Œè¯Šæ–­
diagnosis = diagnose_logger()

# æ‰“å°è¯Šæ–­ç»“æœ
print_logger_diagnosis(diagnosis)
```

## è´¡çŒ®æŒ‡å—

1. **ä»£ç é£æ ¼**ï¼šéµå¾ªé¡¹ç›®çš„ä»£ç é£æ ¼è§„èŒƒ
2. **æµ‹è¯•**ï¼šä¸ºæ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•ç”¨ä¾‹
3. **æ–‡æ¡£**ï¼šæ›´æ–°ç›¸å…³æ–‡æ¡£
4. **æäº¤**ï¼šä½¿ç”¨æ¸…æ™°çš„æäº¤æ¶ˆæ¯

## è®¸å¯è¯

æœ¬æ—¥å¿—ç³»ç»Ÿé‡‡ç”¨MITè®¸å¯è¯ã€‚
